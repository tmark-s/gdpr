<div id="main-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h1><span class="line">{{{headText}}}</span></h1>
            </div>
        </div>
    </div>
</div>
<div id="main-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12">
                <form role="form" class="form-content" id="formSms">
                    <div class="center-block">
                        <label for="mobile" disabled="disabled" class="col-xs-12 col-sm-4">เบอร์โทรศัพท์:</label>
                        <div class="col-xs-12 col-sm-8">
                            <input type="text" name="mobile" class="form-control input-lg" id="mobile" value={{mobileNo}}
                                disabled>
                        </div>
                    </div>

                    <div class="text-choice col-xs-12 col-sm-offset-3 col-sm-8">
                        <p class="indent">เลือกประเภทข้อมูลข่าวสารได้มากกว่า 1 ประเภท</p>
                    </div>

                    <div class="col-xs-12 col-sm-offset-3 col-sm-7">

                        {{#each categories}}
                        <label class="checkbox col-xs-12 col-md-12 col-sm-12">
                            <span class="custom-checkbox">
                                <input type="checkbox" name="ck[]" value={{this.value}} id={{this.value}}>
                                <span class="box"><span class="tick"></span></span>
                            </span>
                            <span class="check-text">{{this.categoryName}}</span>
                        </label>
                        {{/each}}

                        <div class="checkbox col-xs-12 col-md-12 col-sm-12 text-center">
                            <button type="submit" onclick="onSubmit()" class="btn-primary">ตกลง</button>
                        </div>
                        <div class="col-xs-12 col-sm-12 text-center">
                            <p><a href="email-3.2.html" class="textlink">หยุดรับข้อมูลข่าวสาร เป็นเวลา 90 วัน</a></p>
                            <p><a href="email-3.3.html" class="textlink">หยุดรับข้อมูลข่าวสารทั้งหมด</a></p>
                        </div>
                    </div>

                </form>
            </div>
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container -->
    <script>
        ////get value from url to find another channel
        let params = new URLSearchParams(document.location.search.substring(1));
        var name = params.get("choosed");
        var todo = name.split(',')
        var index = todo.indexOf("sms");
        var nexTodo = todo.splice(index, 1)

        ////get input from user
        function onSubmit() {
            var mobileNo = $('#mobile').val();
            var selectedCategories = [];
            $('[name="ck[]"]').each(function () {
                if ($(this).prop('checked') == true) {
                    selectedCategories.push($(this).val())
                }
            });
            //for select next page
            if (todo.length > 0) {
                $.ajax({
                    type: 'POST',
                    url: "http://localhost:3000/subscribe-email",
                    data: { smsSubscribe: selectedCategories },
                    contentType: 'application/json',
                    success: function (data) {
                        window.location.href = "http://localhost:3000/subscribe-email";
                    }
                });
            } else {
                $.ajax({
                    type: 'GET',
                    contentType: 'application/json',
                    success: function (data) {
                        window.location.href = "http://localhost:3000/updated-complete";
                    }
                });
            }
        }

    </script>